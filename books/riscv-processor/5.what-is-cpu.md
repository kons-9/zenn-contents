---
title: "CPUとは"
---
# CPUとは
まずCPUとはなにかを解説します。
CPUとは、Central Processing Unitの略で、コンピュータの中枢を担う部品です。
よく「頭脳」と表現されることもあります。
これはCPUがコンピュータを動かすための命令を実行する部品だからです。

このように聞くと、CPUを理解することは難しそうに思えるかもしれませんが、実はCPUはとてもシンプルな部品です。((もちろんハイエンドなCPUはとても複雑ですが、動く仕組みはシンプルです。))

# 日常の動作を「符号化」する
CPUは電気で動作します。
電気を簡単に扱うために、電気のON/OFFを使うことが一般的です。
電気のON/OFFは、0と1の2つの状態で表現できます。

CPUはこれに対応する形で、バイナリ列という0と1の並びを用いて動作を定義しています。
一般にn進数で表現される数値は、2進数で表現することができます。
このため、CPUは数値を用いて動作を定義しているとも言えます。
このように、数値を用いていろいろな情報を表現することを「符号化」といいます。

例えば、「本」を00, 「ノート」を01, 「読む」を02, 「書く」を03と符号化したとします。
数値をくっつけることで動作を定義すると、次のような命令ができます。

「本を読む」→0110
「ノートを書く」→0220

このように日常の動作は、数値との対応を持つことで電気のON/OFFで表現できるのです。((もちろん、本当に日常の動作すべてを表現するためには膨大な数の符号化が必要ですが、CPUは実際には数十の命令を持つだけです。))

同様にあらゆる動作は符号化することができます。
では、動作を符号化するだけで、よいのでしょうか。
実は動作を符号化するだけでは、不十分です。
動作したことにより、なにが起こったのかを知る必要があるからです。
何が起こったのかを知るためには、起こる前と起こった後の「状態」を知る必要があります。

例えば、「寝ている」という状態と「起きている」という状態は、「寝る」、「起きる」という動作をすることで変化します。
このように、動作によって状態が変化するので、コンピュータ科学では動作のことを「状態遷移」といいます。

実は状態とこの状態遷移を理解することが、CPUを理解するための第一歩です。
なぜなら状態と状態遷移の組を持つものを「状態機械」といい、CPUはこの状態機械の一種だからです。

# CPUの動作
では、CPUはどのような状態と状態遷移を持つのでしょうか。
詳しくは後述しますが、今回作るもっとも簡単なCPUは、例として、次のような状態と状態遷移を持っています。

- 状態
    - プログラムカウンタ
    - レジスタ
    - メモリ
- 状態遷移(抜粋)
    - ADD命令
    - SUB命令
    - LOAD命令
    - STORE命令

レジスタは、演算装置の最も近くにある記憶装置です。
メモリは、レジスタよりも遠くにある記憶装置です。
プログラムカウンタは、メモリに保存されている命令の中で、次に実行すべきアドレスを保持するレジスタです。

レジスタは近くにあるため、非常に高速にアクセスできますが、数が少ないため、あまり大きなデータを保持できません。
メモリは、レジスタよりも遠くにあるため、アクセス速度は遅いですが、数が多いため、大きなデータを保持できます。
メモリ関連の命令以外は、レジスタを使って動作します。

例えば、ADD命令、SUB命令は、レジスタに保持されている2つの数値を足し算、引き算して、レジスタに保持します。
LOAD命令は、メモリに保持されている数値をレジスタに読み込みます。
STORE命令は、レジスタに保持されている数値をメモリに書き込みます。

例えば
```
1: LOAD R1, 0x0000
2: LOAD R2, 0x0001
3: ADD R1, R2, R3
4: STORE R3, 0x0002
```
このような命令列があったとします。
この命令列は、次のような動作をするとします。

1. メモリ0x0000番地に保持されている数値をレジスタ1番目に読み込み
2. メモリ0x0001番地に保持されている数値をレジスタ2番目に読み込み
3. レジスタ1番目とレジスタ2番目に保持されている数値を足し算して
4. レジスタ3番目に保持し、最後にレジスタ3番目に保持されている数値をメモリ0x0002番地に書き込む

CPUの状態はプログラムカウンタ、レジスタ、メモリの3つで構成されていました。
1番目の命令を実行した後はどの状態が変化しているでしょうか。
プログラムカウンタは、次に実行すべき命令のアドレスを保持しているため、2番目の命令のアドレスに更新されます。
また、レジスタ1番目には、メモリ0x0000番地に保持されている数値が読み込まれます。
このためプログラムカウンタと、レジスタ1番目の状態が変化します。（レジスタの値とメモリの値が同一だった場合は、レジスタの値は変化しませんが、一般の動作について述べています。）
2番目の命令を実行した後は、プログラムカウンタ、レジスタ2番目の状態が変化します。
3番目の命令を実行した後は、プログラムカウンタ、レジスタ3番目の状態が変化します。
4番目の命令を実行した後は、プログラムカウンタ、レジスタ3番目、メモリ0x0002番地の状態が変化します。

上記のような命令を繰り返し実行することで、CPUは状態を変化させていきます。
なんとなくCPUがどのような動作をするのか、イメージできたでしょうか。

# 次章の内容
次章では、実際のRISC-Vのアセンブラ命令を用いて、比較的簡単なC言語の命令をコンパイルしてみます。

